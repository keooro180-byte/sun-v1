async function sendMessage() {
    const input = document.getElementById('user-input');
    const output = document.getElementById('output');
    const message = input.value.trim();

    if (message) {
        output.innerHTML += `<div class="user-msg"><strong>أنت:</strong> ${message}</div>`;
        input.value = '';

        try {
            const response = await fetch('/.netlify/functions/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message })
            });

            const data = await response.json();

            if (data.reply) {
                output.innerHTML += `<div class="sun-msg"><strong>[SUN]:</strong> ${data.reply}</div>`;
            } else if (data.error) {
                throw new Error(data.error);
            } else {
                throw new Error("تنسيق رد غير متوقع من النواة");
            }
        } catch (err) {
            output.innerHTML += `<div class="error-msg">⚠️ خطأ سيادي: ${err.message}</div>`;
            console.error("تفاصيل الخطأ التقني:", err);
        }
        
        // التمرير التلقائي لأسفل الشاشة
        output.scrollTop = output.scrollHeight;
    }
}
